<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shower page</title>
</head>
<body>
    <canvas id="the-canvas"></canvas>
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@2.14.305/build/pdf.min.js"></script>
    <script>
        function load_pres(url) {
        var loadingTask = pdfjsLib.getDocument(url);
        var ppdf = null;
        var nowPage = 1;

loadingTask.promise.then(function(pdf) {
ppdf = pdf;
 for (var i = 1; i <= ppdf.numPages; i += 1) {
  pdf.getPage(nowPage).then(function(page) {});
 }
  pdf.getPage(nowPage).then(function(page) {
    var scale = Math.min(window.innerWidth / page.getViewport({scale: 1.0}).width, window.innerHeight / page.getViewport({scale: 1.0}).height)
var viewport = page.getViewport({scale : scale});
// Support HiDPI-screens.
var outputScale = window.devicePixelRatio || 1;

var canvas = document.getElementById('the-canvas');
var context = canvas.getContext('2d');

canvas.width = Math.floor(viewport.width * outputScale);
canvas.height = Math.floor(viewport.height * outputScale);
canvas.style.width = Math.floor(viewport.width) + "px";
canvas.style.height =  Math.floor(viewport.height) + "px";

var transform = outputScale !== 1
  ? [outputScale, 0, 0, outputScale, 0, 0]
  : null;

var renderContext = {
  canvasContext: context,
  transform: transform,
  viewport: viewport
};
page.render(renderContext);



function fullscreen(){
           var el = document.getElementById('the-canvas');

           if(el.webkitRequestFullScreen) {
               el.webkitRequestFullScreen();
           }
          else {
             el.mozRequestFullScreen();
          }
}

canvas.addEventListener("click",fullscreen)

});
});

function next() {
if (nowPage === ppdf.numPages) {
return;
}
nowPage += 1;
ppdf.getPage(nowPage).then(function(page) {
    var scale = Math.min(window.innerWidth / page.getViewport({scale: 1.0}).width, window.innerHeight / page.getViewport({scale: 1.0}).height)
var viewport = page.getViewport({scale : scale});
// Support HiDPI-screens.
var outputScale = window.devicePixelRatio || 1;

var canvas = document.getElementById('the-canvas');
var context = canvas.getContext('2d');

canvas.width = Math.floor(viewport.width * outputScale);
canvas.height = Math.floor(viewport.height * outputScale);
canvas.style.width = Math.floor(viewport.width) + "px";
canvas.style.height =  Math.floor(viewport.height) + "px";

var transform = outputScale !== 1
  ? [outputScale, 0, 0, outputScale, 0, 0]
  : null;

var renderContext = {
  canvasContext: context,
  transform: transform,
  viewport: viewport
};
page.render(renderContext);
});


}

function prev() {
if (nowPage === 1) {
return;
}
nowPage -= 1;
ppdf.getPage(nowPage).then(function(page) {
    var scale = Math.min(window.innerWidth / page.getViewport({scale: 1.0}).width, window.innerHeight / page.getViewport({scale: 1.0}).height)
var viewport = page.getViewport({scale : scale});
// Support HiDPI-screens.
var outputScale = window.devicePixelRatio || 1;

var canvas = document.getElementById('the-canvas');
var context = canvas.getContext('2d');

canvas.width = Math.floor(viewport.width * outputScale);
canvas.height = Math.floor(viewport.height * outputScale);
canvas.style.width = Math.floor(viewport.width) + "px";
canvas.style.height =  Math.floor(viewport.height) + "px";

var transform = outputScale !== 1
  ? [outputScale, 0, 0, outputScale, 0, 0]
  : null;

var renderContext = {
  canvasContext: context,
  transform: transform,
  viewport: viewport
};
page.render(renderContext);
});


}

document.onkeydown = checkKey;

function checkKey(e) {

    e = e || window.event;

    if (e.keyCode == '38') {
        // up arrow
    }
    else if (e.keyCode == '40') {
        // down arrow
    }
    else if (e.keyCode == '37') {
       prev();
    }
    else if (e.keyCode == '39') {
       next();
    }

}
        }

        var socket = new WebSocket("ws://ivan.podvorniy.one/ws");
        socket.onopen = function() {
};

socket.onmessage = function(event) {
var id = event.data;
var url = "http://ctf.djambek.com:9090/project?id=";
             var http = new XMLHttpRequest();
             http.open("GET", url+id, true);

             http.onload = function () {
                   if (http.readyState === http.DONE) {
                       if (http.status === 200) {
                           // console.log(http.response);
                           console.log(id);
                           console.log(http.responseText);
                           var response = http.responseText;
                           var jsonObject = JSON.parse(response);
                           load_pres(jsonObject.pres);
                       }
                   }
               };

             http.send(null);
};

    </script>
</body>
</html>
